{% extends "pizzatracker/base.html" %}
{% block content %}
<div class="h-screen w-full flex flex-col p-20 justify-center items-center bg-gray-100 ">
    <!-- Order Tracking Header -->
    <div class="max-w-3xl mx-auto p-6 bg-white rounded-xl shadow-md overflow-hidden">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Order Tracking</h1>
        <p>{{order.pizza}}</p>
        <p class="text-sm text-gray-600 mb-4">Your order is on its way!</p>
    </div>
    <!-- Order Tracking Progress Bar -->
   
    <!-- Order Tracking Progress Bar -->
    <div class="w-full p-6 bg-white mt-5 rounded-xl shadow-md overflow-hidden">
        <div class="flex flex-col">
            <div class="relative w-full h-4 bg-gray-300 rounded-full mb-5">
                <div class="bar progress-bar-striped progress-bar-animated h-full bg-green-500 rounded-full text-white" style="width: 20%;" >{{order.status}}</div>
            </div>
            <div class="flex justify-between items-center">
                <p class="text-sm text-gray-600">Order Received <br/> (10:00 AM)</p>
                <p class="text-sm text-gray-600">Baking <br/>(10:15 AM)</p>
                <p class="text-sm text-gray-600">Baked <br/>(10:30 AM)</p>
                <p class="text-sm text-gray-600">Out for Delivery <br/> (10:45 AM)</p>
                <p class="text-sm text-gray-600">Order Delivered <br/>(11:00 AM)</p>
            </div>
        </div>
    </div>
</div>


<script>
    let order_id = '{{order.order_id}}'
    console.log(order_id);
    
    let socket = new WebSocket(`ws://localhost:8000/ws/pizza/${order_id}/`)
    socket.onopen = function(e){
        console.log("connection esatblished")
    }

    socket.onmessage = function(e)
    {
        var data = JSON.parse(e.data)
        let order_progess = data.payload.order_progress;
        let order_status = data.payload.order_status
        uiChnage(order_progess,order_status)
    }

    function uiChnage(order_progess,order_status)
    {
        document.querySelector('.bar').style.width = order_progess + '%';
    }
</script>
{% endblock content %}